import{m as c,j as C,k as G,o as e,h as I,b as t,c as l,e as p,d as a,f as K,v as Q,F as V,r as $,a as O,u as Y,S as Z,t as d,n as S,w as tt,p as st,z as et}from"./app-CDjddlxD.js";import{T as q}from"./toast-DPMCFSd1.js";import{_ as lt}from"./DashboardLayout-jvpOWrKU.js";import{_ as at}from"./Pagination-Cn-U2vRS.js";import{_ as ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";const nt={class:"row"},it={class:"col-12"},dt={class:"card"},rt={class:"card-header"},ut={class:"card-tools"},ct=["href"],ft={class:"card-body"},vt={class:"dataTables_wrapper dt-bootstrap4"},mt={class:"row mb-3"},bt={class:"col-sm-12 col-md-6"},pt={class:"dataTables_length"},_t={class:"d-flex align-items-center"},ht={class:"col-sm-12 col-md-6 text-right"},yt={class:"btn-group"},gt=["href"],kt={class:"table-responsive"},Ct={class:"table table-bordered table-striped"},wt={key:0},St={class:"badge bg-info p-2"},xt={class:"d-flex align-items-center"},Tt=["onClick"],Mt={class:"btn-group"},Dt=["href"],Vt=["onClick"],$t={key:1},Nt={key:0,class:"row mt-3"},Lt={class:"col-sm-12 col-md-5"},At={class:"dataTables_info"},Bt={class:"col-sm-12 col-md-7"},jt={class:"dataTables_paginate paging_simple_numbers d-flex justify-content-end"},Et={key:1,class:"row mt-3"},Ft={class:"col-12"},It={class:"dataTables_info"},Ot={key:0,class:"modal-backdrop fade show"},qt={key:1,class:"modal show",tabindex:"-1",style:{display:"block"},"aria-hidden":"true"},Ut={class:"modal-dialog modal-lg"},zt={class:"modal-content"},Jt={class:"modal-header"},Pt={class:"modal-title"},Rt={class:"modal-body"},Xt={key:0,class:"text-center p-5"},Ht={key:1},Wt={key:0},Gt={class:"card card-body bg-light mb-3"},Kt={class:"row"},Qt={class:"list-unstyled contact-list"},Yt={key:1},Zt=["href"],ts={key:1,class:"alert alert-warning"},ss={key:2},es={key:0,class:"text-center py-4"},ls={key:1,class:"card card-body bg-light mb-3"},as={class:"table-responsive"},os={class:"table table-striped"},ns={class:"badge badge-info"},is=["href"],ds={key:2,class:"alert alert-warning"},rs={key:3,class:"alert alert-info"},us={class:"modal-footer"},cs={class:"modal-dialog"},fs={class:"modal-content"},vs={class:"modal-header bg-danger text-white"},ms={class:"modal-body"},bs={class:"modal-footer"},ps=["disabled"],_s={key:0},hs={key:1},ys={key:3,class:"modal-backdrop fade show"},gs={class:"modal-dialog"},ks={class:"modal-content"},Cs={class:"modal-header"},ws={class:"modal-body"},Ss={class:"modal-footer"},xs=["disabled"],Ts={key:0},Ms={key:1},Ds={__name:"Scheduled",props:{texts:Object,filters:Object},setup(y){const x=y,g=c(x.filters.search||""),U=()=>{st.get(route("sms.scheduled"),{search:g.value},{preserveState:!0,replace:!0})},N=C(()=>x.texts.data),n=c(null),w=c(!1),v=c(!1),T=c([]);c(null),c(!1);const z=C(()=>{if(!n.value)return"";switch(n.value.contact_type){case"manual":return"Manual Entry";case"csv":return"CSV Upload";case"list":return"Contact List";default:return"Unknown"}});C(()=>{if(!n.value||n.value.contact_type!=="list"||!n.value.contact_list)return[];try{return JSON.parse(n.value.contact_list)}catch(i){return console.log("Error parsing contact list JSON, trying comma-separated format:",i),n.value.contact_list.split(",").map(s=>s.trim()).filter(Boolean)}});const J=C(()=>{if(!n.value||n.value.contact_type!=="manual"||!n.value.recepient_contacts)return[[],[],[]];const i=n.value.recepient_contacts.split(",").map(r=>r.trim()).filter(Boolean),s=[[],[],[]],m=Math.ceil(i.length/3);return i.forEach((r,f)=>{const b=Math.floor(f/m);b<3?s[b].push(r):s[2].push(r)}),s}),P=C(()=>{if(!n.value)return"fas fa-question-circle mr-2";switch(n.value.contact_type){case"manual":return"fas fa-keyboard mr-2";case"csv":return"fas fa-file-csv mr-2";case"list":return"fas fa-list-alt mr-2";default:return"fas fa-question-circle mr-2"}}),R=C(()=>{if(!n.value)return"alert-secondary";switch(n.value.contact_type){case"manual":return"alert-info";case"csv":return"alert-info";case"list":return"alert-info";default:return"alert-info"}}),X=async i=>{n.value=i,v.value=!0,T.value=[],w.value=!0;try{i.contact_type==="manual"||i.contact_type==="list"&&(T.value=[]),v.value=!1}catch(s){console.error("Error fetching contact data:",s),v.value=!1}},k=c(null),u=c(!1),_=c(!1),H=i=>{k.value=i,u.value=!0},L=()=>{if(!k.value)return;_.value=!0;const i=k.value.text_title,s=k.value.id;et.delete(route("sms.destroy",s),{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(m=>{u.value=!1,_.value=!1,q.success(m.data.message||`Scheduled SMS '${i}' deleted successfully.`);const r=x.texts.data.findIndex(f=>f.id===s);r!==-1&&x.texts.data.splice(r,1)}).catch(m=>{var f,b;_.value=!1;const r=((b=(f=m.response)==null?void 0:f.data)==null?void 0:b.message)||`Failed to delete SMS '${i}'. Please try again.`;q.error(r)})},A=i=>i?new Date(i).toLocaleString():"";return(i,s)=>(e(),G(lt,null,{default:I(()=>{var m,r,f,b,B,j,E,F;return[t("div",nt,[t("div",it,[t("div",dt,[t("div",rt,[s[8]||(s[8]=t("h3",{class:"card-title"},[t("i",{class:"far fa-clock nav-icon"}),a("   Scheduled SMS Messages ")],-1)),t("div",ut,[t("a",{href:i.route("sms.create"),class:"btn btn-primary btn-sm"},s[7]||(s[7]=[t("i",{class:"fas fa-plus mr-1"},null,-1),a(" New Scheduled SMS ")]),8,ct)])]),t("div",ft,[t("div",vt,[t("div",mt,[t("div",bt,[t("div",pt,[t("label",_t,[s[9]||(s[9]=a(" Search: ")),K(t("input",{type:"search",class:"form-control form-control-sm ms-2 ml-2",placeholder:"Search scheduled messages...","onUpdate:modelValue":s[0]||(s[0]=o=>g.value=o),onInput:U},null,544),[[Q,g.value]])])])]),t("div",ht,[t("div",yt,[t("a",{href:i.route("sms.export.csv",{search:g.value,scheduled:1}),class:"btn btn-success btn-sm"},s[10]||(s[10]=[t("i",{class:"fas fa-file-csv mr-1"},null,-1),a(" Export to CSV ")]),8,gt)])])]),t("div",kt,[t("table",Ct,[s[15]||(s[15]=t("thead",null,[t("tr",null,[t("th",null,"Title"),t("th",null,"Status"),t("th",null,"Schedule Date"),t("th",null,"Contacts"),t("th",null,"Created By"),t("th",null,"Created At"),t("th",null,"Actions")])],-1)),N.value.length>0?(e(),l("tbody",wt,[(e(!0),l(V,null,$(N.value,o=>{var h,M,D;return e(),l("tr",{key:o.id},[t("td",null,[t("b",null,[O(Y(Z),{href:i.route("sms.show",o.id)},{default:I(()=>[a(d(o.text_title),1)]),_:2},1032,["href"])])]),t("td",null,[t("span",{class:S(["badge","bg-"+((h=o.status)==null?void 0:h.color_code)])},d((M=o.status)==null?void 0:M.text_status_name),3)]),t("td",null,[t("span",St,d(A(o.schedule_date)),1)]),t("td",null,[t("div",xt,[t("button",{class:"btn btn-sm btn-outline-info ml-2",onClick:tt(W=>X(o),["prevent"]),title:"View Contacts"},s[11]||(s[11]=[t("i",{class:"fas fa-eye"},null,-1),a(" view ")]),8,Tt)])]),t("td",null,d((D=o.creator)==null?void 0:D.name),1),t("td",null,d(A(o.created_at)),1),t("td",null,[t("div",Mt,[t("a",{href:i.route("sms.show",o.id),class:"btn btn-outline-info btn-sm"},s[12]||(s[12]=[t("i",{class:"fas fa-eye"},null,-1)]),8,Dt),t("button",{onClick:W=>H(o),class:"btn btn-outline-danger btn-sm"},s[13]||(s[13]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Vt)])])])}),128))])):(e(),l("tbody",$t,s[14]||(s[14]=[t("tr",null,[t("td",{colspan:"7",class:"text-center"}," No scheduled SMS messages found. ")],-1)])))])]),y.texts.data.length>0?(e(),l("div",Nt,[t("div",Lt,[t("div",At," Showing "+d(y.texts.from)+" to "+d(y.texts.to)+" of "+d(y.texts.total)+" entries ",1)]),t("div",Bt,[t("div",jt,[O(at,{links:y.texts.links},null,8,["links"])])])])):p("",!0),g.value?(e(),l("div",Et,[t("div",Ft,[t("div",It," Found "+d(N.value.length)+' matching results for "'+d(g.value)+'" ',1)])])):p("",!0)])])])])]),w.value?(e(),l("div",Ot)):p("",!0),w.value?(e(),l("div",qt,[t("div",Ut,[t("div",zt,[t("div",Jt,[t("h5",Pt,[s[16]||(s[16]=t("i",{class:"fas fa-address-book mr-2"},null,-1)),a(" Contacts for: "+d((m=n.value)==null?void 0:m.text_title),1)]),t("button",{type:"button",class:"close",onClick:s[1]||(s[1]=o=>w.value=!1),"aria-label":"Close"},s[17]||(s[17]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("div",Rt,[v.value?(e(),l("div",Xt,s[18]||(s[18]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("p",{class:"mt-2"},"Loading contacts...",-1)]))):(e(),l("div",Ht,[t("div",{class:S(["alert",R.value])},[t("i",{class:S(P.value)},null,2),s[19]||(s[19]=t("strong",null,"Contact Type:",-1)),a(" "+d(z.value),1)],2),((r=n.value)==null?void 0:r.contact_type)==="manual"&&((f=n.value)!=null&&f.recepient_contacts)?(e(),l("div",Wt,[t("div",Gt,[t("div",Kt,[(e(!0),l(V,null,$(J.value,(o,h)=>(e(),l("div",{key:h,class:"col-md-4"},[t("ul",Qt,[(e(!0),l(V,null,$(o,(M,D)=>(e(),l("li",{key:D,class:"mb-2"},[s[20]||(s[20]=t("i",{class:"fas fa-mobile-alt text-primary mr-2"},null,-1)),a(" "+d(M),1)]))),128))])]))),128))])])])):((b=n.value)==null?void 0:b.contact_type)==="csv"?(e(),l("div",Yt,[s[23]||(s[23]=t("p",{class:"mb-3"},[t("i",{class:"fas fa-file-csv mr-2"}),a(" Contacts were uploaded via CSV file. ")],-1)),(B=n.value)!=null&&B.csv_file_path?(e(),l("a",{key:0,href:i.route("sms.download.csv",[n.value.csv_file_name]),class:"btn btn-primary",download:""},s[21]||(s[21]=[t("i",{class:"fas fa-download mr-2"},null,-1),a(" Download Original CSV File ")]),8,Zt)):(e(),l("div",ts,s[22]||(s[22]=[t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1),a(" The original CSV file is not available. ")])))])):((j=n.value)==null?void 0:j.contact_type)==="list"?(e(),l("div",ss,[v.value?(e(),l("div",es,s[24]||(s[24]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("p",{class:"mt-2"},"Loading contacts from selected lists...",-1)]))):T.value.length>0?(e(),l("div",ls,[t("div",as,[t("table",os,[s[27]||(s[27]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Contact Name"),t("th",null,"Contacts Count"),t("th",null,"Actions")])],-1)),t("tbody",null,[(e(!0),l(V,null,$(T.value,(o,h)=>(e(),l("tr",{key:o.id||h},[t("td",null,d(h+1),1),t("td",null,[s[25]||(s[25]=t("i",{class:"fas fa-users text-primary mr-2"},null,-1)),a(" "+d(o.full_name),1)]),t("td",null,[t("span",ns,d(o.contacts_count||0),1)]),t("td",null,[t("a",{href:i.route("contacts.show",o.id),class:"btn btn-sm btn-info",target:"_blank"},s[26]||(s[26]=[t("i",{class:"fas fa-eye"},null,-1),a(" View ")]),8,is)])]))),128))])])])])):v.value?p("",!0):(e(),l("div",ds,s[28]||(s[28]=[t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1),a(" No contacts found for the selected list(s). ")])))])):(e(),l("div",rs,s[29]||(s[29]=[t("i",{class:"fas fa-info-circle mr-2"},null,-1),a(" No contact information is available. ")])))]))]),t("div",us,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[2]||(s[2]=o=>w.value=!1)}," Close ")])])])])):p("",!0),u.value?(e(),l("div",{key:2,class:S(["modal fade",{show:u.value}]),style:{display:"block"}},[t("div",cs,[t("div",fs,[t("div",vs,[s[31]||(s[31]=t("h5",{class:"modal-title"},[t("i",{class:"fas fa-exclamation-triangle mr-2"}),a(" Confirm Delete ")],-1)),t("button",{type:"button",class:"close text-white","aria-label":"Close",onClick:s[3]||(s[3]=o=>u.value=!1)},s[30]||(s[30]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("div",ms,[t("p",null,[s[32]||(s[32]=a(" Are you sure you want to delete the scheduled SMS ")),t("strong",null,d((E=k.value)==null?void 0:E.text_title),1),s[33]||(s[33]=a("? "))]),s[34]||(s[34]=t("p",null,"This action cannot be undone.",-1))]),t("div",bs,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[4]||(s[4]=o=>u.value=!1)}," Cancel "),t("button",{type:"button",class:"btn btn-danger",onClick:L,disabled:_.value},[_.value?(e(),l("span",_s,s[35]||(s[35]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),a(" Deleting... ")]))):(e(),l("span",hs,s[36]||(s[36]=[t("i",{class:"fas fa-trash mr-1"},null,-1),a(" Delete ")])))],8,ps)])])])],2)):p("",!0),u.value?(e(),l("div",ys)):p("",!0),u.value?(e(),l("div",{key:4,class:S(["modal fade",{show:u.value}]),style:{display:"block"}},[t("div",gs,[t("div",ks,[t("div",Cs,[s[38]||(s[38]=t("h5",{class:"modal-title"},[t("i",{class:"fas fa-exclamation-triangle text-danger mr-2"}),a(" Confirm Delete ")],-1)),t("button",{type:"button",class:"close","aria-label":"Close",onClick:s[5]||(s[5]=o=>u.value=!1)},s[37]||(s[37]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("div",ws,[t("p",null,[s[39]||(s[39]=a(" Are you sure you want to delete the scheduled SMS: ")),t("strong",null,d((F=k.value)==null?void 0:F.text_title),1),s[40]||(s[40]=a("? "))]),s[41]||(s[41]=t("p",{class:"text-danger"},[t("i",{class:"fas fa-exclamation-circle mr-1"}),a(" This action cannot be undone. ")],-1))]),t("div",Ss,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[6]||(s[6]=o=>u.value=!1)}," Cancel "),t("button",{type:"button",class:"btn btn-danger",onClick:L,disabled:_.value},[_.value?(e(),l("span",Ts,s[42]||(s[42]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),a(" Deleting... ")]))):(e(),l("span",Ms,s[43]||(s[43]=[t("i",{class:"fas fa-trash mr-1"},null,-1),a(" Delete ")])))],8,xs)])])])],2)):p("",!0)]}),_:1}))}},Bs=ot(Ds,[["__scopeId","data-v-cd354da0"]]);export{Bs as default};
