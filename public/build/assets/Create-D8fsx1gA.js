import{m as _,j,q as O,I as we,c,o as n,b as e,e as p,f as E,t as u,F as K,r as Q,d as m,w as D,n as x,C as Ce,v as B,x as ke,k as Se,h as xe,u as v,J as G,a as Me,i as Ve}from"./app-CDjddlxD.js";import{T as J}from"./toast-DPMCFSd1.js";import{_ as Ee}from"./DashboardLayout-jvpOWrKU.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ie={class:"multiselect-container"},Te={class:"selected-options"},De={key:0,class:"placeholder text-muted"},Fe={key:1,class:"selected-tags"},Ue=["onClick"],$e={class:"dropdown-icon"},Pe={key:0,class:"invalid-feedback"},ze={class:"dropdown-menu show w-100"},Le={class:"px-2 py-1"},Be={class:"options-container"},qe=["onClick"],Ae={class:"ms-2"},Ne={key:0,class:"text-muted ms-1"},Re={key:0,class:"dropdown-item text-muted"},Oe={__name:"MultiSelect",props:{options:{type:Array,required:!0},modelValue:{type:Array,default:()=>[]},placeholder:{type:String,default:"Select options"},error:{type:String,default:""}},emits:["update:modelValue"],setup($,{emit:q}){const F=$,s=q,g=_(!1),M=_(""),U=h=>{const y=document.querySelector(".multiselect-container");y&&!y.contains(h.target)&&(g.value=!1)},w=j(()=>F.options.filter(h=>F.modelValue.includes(h.id))),k=j(()=>M.value?F.options.filter(h=>h.label.toLowerCase().includes(M.value.toLowerCase())):F.options),S=h=>F.modelValue.includes(h),L=()=>{g.value=!g.value},d=h=>{const y=[...F.modelValue],r=y.indexOf(h);r===-1?y.push(h):y.splice(r,1),s("update:modelValue",y)},o=h=>{const y=F.modelValue.filter(r=>r!==h);s("update:modelValue",y)};return O(()=>{document.addEventListener("click",U)}),we(()=>{document.removeEventListener("click",U)}),(h,y)=>(n(),c("div",Ie,[e("div",{class:x(["form-select select2-container",{"is-invalid":$.error}]),onClick:L},[e("div",Te,[$.modelValue.length===0?(n(),c("div",De,u($.placeholder),1)):(n(),c("div",Fe,[(n(!0),c(K,null,Q(w.value,r=>(n(),c("span",{key:r.id,class:"selected-tag"},[m(u(r.label)+" ",1),e("button",{type:"button",class:"btn-close ms-1",onClick:D(A=>o(r.id),["stop"])},null,8,Ue)]))),128))]))]),e("div",$e,[e("i",{class:x(["fas",g.value?"fa-chevron-up":"fa-chevron-down"])},null,2)])],2),$.error?(n(),c("div",Pe,u($.error),1)):p("",!0),E(e("div",ze,[e("div",Le,[E(e("input",{type:"text",class:"form-control form-control-sm",placeholder:"Search...","onUpdate:modelValue":y[0]||(y[0]=r=>M.value=r),onClick:y[1]||(y[1]=D(()=>{},["stop"]))},null,512),[[B,M.value]])]),y[2]||(y[2]=e("div",{class:"dropdown-divider"},null,-1)),e("div",Be,[(n(!0),c(K,null,Q(k.value,r=>(n(),c("button",{key:r.id,type:"button",class:x(["dropdown-item",{active:S(r.id)}]),onClick:D(A=>d(r.id),["stop"])},[e("i",{class:x(["fas",S(r.id)?"fa-check-square":"fa-square"])},null,2),e("span",Ae,u(r.label),1),r.count!==void 0?(n(),c("small",Ne,"("+u(r.count)+" contacts)",1)):p("",!0)],10,qe))),128)),k.value.length===0?(n(),c("div",Re," No matching options found ")):p("",!0)])],512),[[Ce,g.value]])]))}},je=te(Oe,[["__scopeId","data-v-2892556f"]]),He={class:"row"},We={class:"col-12"},Ge={class:"card"},Je={class:"card-body"},Ke={class:"form-group mb-4"},Qe={key:0,class:"invalid-feedback"},Ye={class:"form-group mb-4"},Xe={class:"mt-2"},Ze={class:"form-check form-check-inline"},et={class:"form-check form-check-inline"},tt={class:"form-check form-check-inline"},st={key:0,class:"text-danger mt-1"},at={class:"form-group mb-4"},lt={key:0},ot={key:0,class:"invalid-feedback"},nt={key:1},it={key:0,class:"csv-file-preview mt-3"},ct={class:"preview-content"},dt={class:"file-name"},rt={key:0,class:"file-details"},ut={key:1,class:"text-danger mt-1"},vt={key:2},mt={class:"form-group mb-4"},pt={class:"position-relative"},ft={class:"dropdown"},_t={key:0,class:"column-dropdown"},gt={class:"column-list"},ht=["onClick"],yt={key:0,class:"no-columns"},bt={class:"d-flex justify-content-end mt-1"},wt={key:0},Ct={key:1},kt={key:0,class:"invalid-feedback d-block"},St={class:"form-group mb-4"},xt={class:"form-check mb-2"},Mt={key:0,class:"schedule-picker-container mt-3"},Vt={class:"row"},Et={class:"col-md-6"},It=["min"],Tt={class:"col-md-6"},Dt={class:"mt-2"},Ft={key:0,class:"schedule-preview"},Ut={key:0,class:"invalid-feedback d-block"},$t={class:"mt-4"},Pt=["disabled"],zt={class:"modal fade",id:"csvUploadModal",tabindex:"-1","aria-hidden":"true"},Lt={class:"modal-dialog modal-dialog-centered"},Bt={class:"modal-content csv-upload-modal"},qt={class:"modal-body"},At={class:"upload-area mb-3"},Nt={key:0,class:"upload-loading"},Rt={key:1,class:"upload-prompt"},Ot={key:2,class:"file-preview"},jt={class:"file-info"},Ht={class:"file-name"},Wt={class:"file-size"},Gt={key:0,class:"csv-validation-error mt-2"},Jt={class:"modal-footer"},Kt=["disabled"],Qt=["disabled"],Yt={class:"modal fade",id:"previewModal",tabindex:"-1","aria-hidden":"true"},Xt={class:"modal-dialog modal-dialog-centered"},Zt={class:"modal-content"},es={class:"modal-body p-2"},ts={key:0,class:"text-center p-4"},ss={key:1,class:"sms-preview-container"},as={class:"card mb-4 message-preview-card"},ls={class:"card-body pb-0"},os={class:"mb-4"},ns={class:"card mb-4"},is={class:"card-body p-0"},cs={class:"stats-grid"},ds={class:"stat-box"},rs={class:"stat-value total"},us={class:"stat-box"},vs={class:"stat-value valid"},ms={class:"stat-box"},ps={class:"stat-value invalid"},fs={class:"stat-box"},_s={class:"stat-value"},gs={key:0,class:"card schedule-card"},hs={class:"card-body"},ys={class:"schedule-info"},bs={class:"schedule-date"},ws={key:2,class:"alert alert-danger"},Cs={class:"modal-footer"},ks=["disabled"],Ss={__name:"Create",props:{contacts:Array},setup($){let q;const F=$,s=ke({text_title:"",contact_type:"manual",recepient_contacts:"",contact_list:[],message:"",scheduled:!1,schedule_date:null,csv_file:null,csv_file_path:"",csv_columns:[],contacts_count:0}),g=_(null),M=_(""),U=_(""),w=_([]),k=_(""),S=_(!1),L=_(!1),d=_({}),o=_(null),h=_(!1),y=_(0),r=_(null),A=_(null),P=_(!1),I=_(""),T=_(""),z=j(()=>160-(s.message?s.message.length:0)),se=()=>{const a=new Date,t=a.getFullYear(),l=(a.getMonth()+1).toString().padStart(2,"0"),i=a.getDate().toString().padStart(2,"0");return`${t}-${l}-${i}`},Y=(a,t)=>{if(!a||!t)return"";try{const[l,i,f]=a.split("-"),[b,V]=t.split(":");let C=parseInt(b);const be=C>=12?"PM":"AM";return C=C%12,C=C||12,`${f}/${i}/${l} ${C}:${V} ${be}`}catch(l){return console.error("Error formatting date display:",l),""}},H=()=>{if(I.value&&T.value){const[a,t,l]=I.value.split("-"),[i,f]=T.value.split(":"),b=new Date(Date.UTC(parseInt(a),parseInt(t)-1,parseInt(l),parseInt(i),parseInt(f)));s.schedule_date=b}},ae=()=>{P.value=!P.value,console.log("Column dropdown toggled:",P.value,"Available columns:",w.value)};O(()=>{document.addEventListener("click",a=>{const t=document.querySelector(".dropdown");P.value&&t&&!t.contains(a.target)&&(P.value=!1)})});const le=j(()=>F.contacts.map(a=>({id:a.id,label:a.title,count:a.contact_lists_count||0}))),oe=_(null),X=()=>{setTimeout(()=>{const a=document.querySelector("#contact_list");if(a&&s.contact_list&&s.contact_list.length>0){let t=a.querySelector(".selected-count");if(!t){t=document.createElement("span"),t.className="selected-count";const l=a.querySelector(".multiselect__tags");l&&l.appendChild(t)}t.textContent=`${s.contact_list.length} selected`,t.style.display="block"}else{const t=document.querySelector(".selected-count");t&&(t.style.display="none")}},50)};O(()=>{s.contact_list&&s.contact_list.length>0&&X()});const Z=async a=>{var l,i;const t=a.target.files;if(t.length>0){const f=t[0];if(f.type==="text/csv"||f.name.endsWith(".csv")){S.value=!0,k.value="";try{const b=new FormData;b.append("csv_file",f);const V=await axios.post(route("csv.validate"),b,{headers:{"Content-Type":"multipart/form-data"}});if(V.data.status==="success"){console.log("Raw response data:",V.data),g.value=f,M.value=V.data.file_name,U.value=V.data.file_path;const C=V.data.columns;Array.isArray(C)&&C.length>0?(w.value=[...C],console.log("CSV Columns (array format):",w.value)):C&&typeof C=="object"?(w.value=Object.keys(C),console.log("CSV Columns (object keys):",w.value)):(console.error("Columns in unexpected format:",C),w.value=[]),s.csv_columns=[...w.value],s.csv_file_path=V.data.file_path,s.csv_file=f,s.contact_type="csv",R()}else k.value=V.data.message||"CSV validation failed",g.value=null,r.value&&(r.value.value="")}catch(b){console.error("CSV validation error:",b),k.value=((i=(l=b.response)==null?void 0:l.data)==null?void 0:i.message)||"An error occurred during CSV validation",g.value=null,document.getElementById("csv_file")&&(document.getElementById("csv_file").value="")}finally{S.value=!1}}else k.value="Please select a valid CSV file",a.target.value=""}},ne=a=>{if(a===0)return"0 Bytes";const t=1024,l=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,i)).toFixed(2))+" "+l[i]},N=_(!1),ie=a=>{N.value=!0,a.dataTransfer.dropEffect="copy"},ce=()=>{N.value=!1},de=a=>{if(N.value=!1,S.value)return;const t=a.dataTransfer.files;if(t.length>0){const l=t[0];if(r.value){const i=new DataTransfer;i.items.add(l),r.value.files=i.files,Z({target:{files:i.files}})}}},re=()=>{r.value&&r.value.click()},ue=a=>{a.stopPropagation(),g.value=null,k.value="",r.value&&(r.value.value="")},ve=()=>{g.value=null,M.value="",U.value="",w.value=[],k.value="",s.csv_file=null,s.csv_file_path="",s.csv_columns=[],r.value&&(r.value.value="")},me=a=>{const t=A.value;if(t){const l=t.selectionStart,i=t.selectionEnd,f=`{${a}}`,b=s.message.substring(0,l),V=s.message.substring(i);s.message=b+f+V,setTimeout(()=>{t.focus(),t.setSelectionRange(l+f.length,l+f.length)},0),P.value=!1}},pe=()=>{try{if(g.value=null,M.value="",U.value="",w.value=[],k.value="",r.value&&(r.value.value=""),window.bootstrap)new window.bootstrap.Modal(document.getElementById("csvUploadModal")).show();else if(q)new q(document.getElementById("csvUploadModal")).show();else{const a=document.getElementById("csvUploadModal");a.style.display="block",a.classList.add("show"),document.body.classList.add("modal-open");const t=document.createElement("div");t.className="modal-backdrop fade show",document.body.appendChild(t)}}catch(a){console.error("Error opening modal:",a),alert("There was an error opening the file upload dialog")}},R=()=>{try{if(window.bootstrap){const a=window.bootstrap.Modal.getInstance(document.getElementById("csvUploadModal"));a&&a.hide()}else{const a=document.getElementById("csvUploadModal");a.style.display="none",a.classList.remove("show"),document.body.classList.remove("modal-open");const t=document.querySelector(".modal-backdrop");t&&t.parentNode.removeChild(t)}}catch(a){console.error("Error closing modal:",a)}},fe=()=>{g.value&&(console.log("CSV file confirmed. Columns:",w.value),s.csv_file=g.value,s.csv_file_path=U.value,s.csv_columns=w.value,s.contact_type="csv",R())},_e=()=>{y.value=s.message?s.message.length:0},ge=()=>{let a=!0;return d.value={},console.log("Validating - Contact Type:",s.contact_type),console.log("Manual contacts:",s.recepient_contacts),console.log("Contact list:",s.contact_list),console.log("CSV file path:",s.csv_file_path),s.text_title||(d.value.text_title="The title field is required",a=!1),s.message||(d.value.message="The message field is required",a=!1),s.contact_type||(d.value.contact_type="The contact type field is required",a=!1),s.contact_type==="manual"&&(!s.recepient_contacts||s.recepient_contacts.trim()==="")&&(d.value.recepient_contacts="Please enter comma-separated contact numbers",a=!1),s.contact_type==="contact_list"&&(!s.contact_list||!Array.isArray(s.contact_list)||s.contact_list.length===0)&&(d.value.contact_list="Please select at least one contact group",a=!1),s.contact_type==="csv"&&(s.csv_file_path||(d.value.csv_file="Please upload a CSV file",a=!1)),s.scheduled&&(!I.value||!T.value)&&(d.value.schedule_date="Please select both date and time",a=!1),console.log("Validation result:",a),console.log("Validation errors:",d.value),a},he=async()=>{if(!ge()){const a=document.querySelector(".is-invalid, .invalid-feedback");a&&a.scrollIntoView({behavior:"smooth",block:"center"});return}try{h.value=!0,o.value=null,s.scheduled&&H();const a=new FormData;let t=s.contact_type;s.contact_type==="contact_list"&&(t="list"),a.append("text_title",s.text_title),a.append("message",s.message),a.append("contact_type",t),t==="manual"?a.append("recepient_contacts",s.recepient_contacts||""):t==="csv"?(a.append("csv_file_path",s.csv_file_path||""),s.csv_file&&a.append("csv_file",s.csv_file)):t==="list"&&Array.isArray(s.contact_list)&&s.contact_list.length>0&&s.contact_list.forEach(f=>{a.append("contact_list[]",f)}),a.append("message",s.message),a.append("text_title",s.text_title),s.scheduled&&(H(),a.append("scheduled",s.scheduled),s.schedule_date&&a.append("schedule_date",s.schedule_date.toISOString())),(()=>{const f=document.getElementById("previewModal");if(window.bootstrap){let b=window.bootstrap.Modal.getInstance(f);b||(b=new window.bootstrap.Modal(f,{backdrop:"static",keyboard:!1})),b.show()}else{f.style.display="block",f.classList.add("show"),document.body.classList.add("modal-open");const b=document.createElement("div");b.className="modal-backdrop fade show",document.body.appendChild(b)}})();const i=await axios.post(route("sms.preview"),a,{headers:{"Content-Type":"multipart/form-data"}});console.log("Raw preview response:",i.data),i.data.status==="success"&&i.data.preview?(console.log("Raw preview data from backend:",i.data.preview),o.value=i.data.preview,console.log("Personalized message received:",o.value.personalizedMessage),o.value.validContacts=o.value.validContacts||0,o.value.invalidContacts=o.value.invalidContacts||0,o.value.totalContacts=o.value.totalContacts||o.value.contacts_count||0,o.value.messageTotalChars=o.value.messageTotalChars||s.message.length,!o.value.personalizedMessage&&o.value.message?o.value.personalizedMessage=o.value.message:o.value.personalizedMessage||(o.value.personalizedMessage=s.message)):i.data&&(o.value=i.data,console.log("Raw preview data from server:",i.data),o.value.validContacts=i.data.validContacts||0,o.value.invalidContacts=i.data.invalidContacts||0,o.value.totalContacts=i.data.totalContacts||i.data.contacts_count||0,o.value.messageTotalChars=i.data.messageTotalChars||s.message.length,o.value.personalizedMessage=i.data.personalizedMessage||s.message,o.value.originalMessage=i.data.originalMessage||s.message,s.contact_type==="csv"&&i.data.customizationInfo?o.value.customizationInfo=i.data.customizationInfo:s.contact_type==="csv"&&i.data.personalizedMessage&&i.data.personalizedMessage!==s.message&&(o.value.customizationInfo="Message shown is personalized using the first row of your CSV data. Each recipient will receive their own customized message.")),console.log("Processed preview data:",o.value)}catch(a){a.response&&a.response.data&&a.response.data.errors?(d.value=a.response.data.errors,console.error("Validation errors:",a.response.data.errors)):a.response&&a.response.data&&a.response.data.message?(alert("Error: "+a.response.data.message),console.error("Server error:",a.response.data.message)):(console.error("Error previewing message:",a),alert("An error occurred while previewing your message. Please try again."))}finally{h.value=!1}},ee=()=>{if(d.value={},s.scheduled){if(!I.value||!T.value){d.value.schedule_date="Please select both date and time";return}H()}else s.schedule_date=null;L.value=!0,s.post(route("sms.store"),{forceFormData:!0,onSuccess:a=>{s.scheduled?J.success("SMS scheduled successfully for "+s.schedule_date):J.success("SMS created successfully and queued for sending."),s.reset(),M.value="",I.value="",T.value="",L.value=!1},onError:a=>{d.value=a,L.value=!1,J.error("There was an error submitting the form. Please check the fields and try again.")}})},W=()=>{try{if(window.bootstrap){const a=window.bootstrap.Modal.getInstance(document.getElementById("previewModal"));a&&a.hide()}else{const a=document.getElementById("previewModal");a.style.display="none",a.classList.remove("show"),document.body.classList.remove("modal-open");const t=document.querySelector(".modal-backdrop");t&&t.parentNode.removeChild(t)}}catch(a){console.error("Error closing preview modal:",a)}},ye=()=>{o.value&&o.value.totalContacts?s.contacts_count=o.value.totalContacts:o.value&&o.value.contacts_count&&(s.contacts_count=o.value.contacts_count),console.log("Contacts count to be stored:",s.contacts_count),W(),ee()};return O(()=>{const a=new Date;a.setHours(a.getHours()+1),s.schedule_date=a.toISOString().slice(0,16),window.bootstrap?q=window.bootstrap.Modal:console.warn("Bootstrap not found. Using fallback modal handling.")}),(a,t)=>(n(),Se(Ee,null,{default:xe(()=>[e("div",He,[e("div",We,[e("div",Ge,[t[35]||(t[35]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"New SMS")],-1)),e("div",Je,[e("form",{onSubmit:D(ee,["prevent"])},[e("div",Ke,[t[12]||(t[12]=e("label",{for:"text_title",class:"form-label fw-bold"},[m("Title of SMS / Campaign"),e("span",{class:"text-danger"},"*")],-1)),E(e("input",{type:"text",id:"text_title","onUpdate:modelValue":t[0]||(t[0]=l=>v(s).text_title=l),class:x(["form-control",{"is-invalid":d.value.text_title}]),placeholder:"Enter the SMS/Campaign Title"},null,2),[[B,v(s).text_title]]),d.value.text_title?(n(),c("div",Qe,u(d.value.text_title),1)):p("",!0)]),e("div",Ye,[t[16]||(t[16]=e("label",{class:"form-label fw-bold"},[m("Select Contact Source"),e("span",{class:"text-danger"},"*")],-1)),e("div",Xe,[e("div",Ze,[E(e("input",{class:"form-check-input",type:"radio",id:"contact_type_manual","onUpdate:modelValue":t[1]||(t[1]=l=>v(s).contact_type=l),value:"manual"},null,512),[[G,v(s).contact_type]]),t[13]||(t[13]=e("label",{class:"form-check-label",for:"contact_type_manual"},"Enter Recipient Contacts",-1))]),e("div",et,[E(e("input",{class:"form-check-input",type:"radio",id:"contact_type_csv","onUpdate:modelValue":t[2]||(t[2]=l=>v(s).contact_type=l),value:"csv"},null,512),[[G,v(s).contact_type]]),t[14]||(t[14]=e("label",{class:"form-check-label",for:"contact_type_csv"},"Import from a CSV File",-1))]),e("div",tt,[E(e("input",{class:"form-check-input",type:"radio",id:"contact_type_list","onUpdate:modelValue":t[3]||(t[3]=l=>v(s).contact_type=l),value:"list"},null,512),[[G,v(s).contact_type]]),t[15]||(t[15]=e("label",{class:"form-check-label",for:"contact_type_list"},"From a Saved Contact List",-1))])]),d.value.contact_type?(n(),c("div",st,u(d.value.contact_type),1)):p("",!0)]),e("div",at,[v(s).contact_type==="manual"?(n(),c("div",lt,[t[17]||(t[17]=e("label",{for:"recepient_contacts",class:"form-label fw-bold"},[m("Enter Contacts (comma-separated)"),e("span",{class:"text-danger"},"*")],-1)),E(e("textarea",{id:"recepient_contacts","onUpdate:modelValue":t[4]||(t[4]=l=>v(s).recepient_contacts=l),class:x(["form-control",{"is-invalid":d.value.recepient_contacts}]),rows:"2",placeholder:"Enter the contacts comma separated e.g. 0712345678,0714345678"},null,2),[[B,v(s).recepient_contacts]]),d.value.recepient_contacts?(n(),c("div",ot,u(d.value.recepient_contacts),1)):p("",!0)])):p("",!0),v(s).contact_type==="csv"?(n(),c("div",nt,[t[22]||(t[22]=e("label",{class:"form-label fw-bold"},[m(" Upload CSV File"),e("span",{class:"text-danger"},"*")],-1)),e("div",{class:"input-group"},[e("button",{type:"button",class:"btn btn-primary",onClick:pe},t[18]||(t[18]=[e("i",{class:"fas fa-upload me-1"},null,-1),m(" Upload CSV File ")]))]),M.value?(n(),c("div",it,[e("div",{class:"preview-header"},[t[20]||(t[20]=e("h6",null,[e("i",{class:"fas fa-file-csv me-2"}),m(" CSV File Uploaded ")],-1)),e("button",{type:"button",class:"btn-remove-preview",onClick:ve},t[19]||(t[19]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",ct,[e("div",dt,u(M.value),1),w.value.length>0?(n(),c("div",rt,t[21]||(t[21]=[e("div",{class:"file-help-text mt-2"},[e("small",{class:"text-muted"},[m("Use the "),e("code",null,"{ }"),m(" button next to the message box to insert column values")])],-1)]))):p("",!0)])])):p("",!0),d.value.csv_file?(n(),c("div",ut,u(d.value.csv_file),1)):p("",!0)])):p("",!0),v(s).contact_type==="list"?(n(),c("div",vt,[t[23]||(t[23]=e("label",{for:"contact_list",class:"form-label fw-bold"},[m("Select Contact Group"),e("span",{class:"text-danger"},"*")],-1)),Me(je,{id:"contact_list",modelValue:v(s).contact_list,"onUpdate:modelValue":t[5]||(t[5]=l=>v(s).contact_list=l),options:le.value,"track-by":"id",label:"label",placeholder:"Select contact groups","show-labels":!1,"clear-on-select":!1,"preserve-search":!0,error:d.value.contact_list,onInput:X,ref_key:"contactMultiSelect",ref:oe},null,8,["modelValue","options","error"]),t[24]||(t[24]=e("small",{class:"form-text text-muted"},"Click to search and select multiple contact groups",-1))])):p("",!0)]),e("div",mt,[t[27]||(t[27]=e("label",{for:"message",class:"form-label fw-bold"},[m("Message"),e("span",{class:"text-danger"},"*")],-1)),e("div",pt,[v(s).contact_type==="csv"&&U.value?(n(),c("div",{key:0,class:"message-tools",onClick:t[6]||(t[6]=D(()=>{},["stop"]))},[e("div",ft,[e("button",{class:"btn btn-sm btn-outline-secondary column-btn",type:"button",onClick:ae},t[25]||(t[25]=[e("span",{class:"column-btn-icon"},"{ }",-1)])),P.value?(n(),c("div",_t,[t[26]||(t[26]=e("div",{class:"column-dropdown-header"},"Insert Column",-1)),e("div",gt,[(n(!0),c(K,null,Q(w.value,l=>(n(),c("button",{key:l,class:"column-item",onClick:D(i=>me(l),["prevent"]),type:"button"},u(l),9,ht))),128))]),!w.value||w.value.length===0?(n(),c("div",yt," No columns available ")):p("",!0)])):p("",!0)])])):p("",!0),E(e("textarea",{id:"message","onUpdate:modelValue":t[7]||(t[7]=l=>v(s).message=l),class:x(["form-control",{"is-invalid":d.value.message,"has-column-selector":v(s).contact_type==="csv"&&U.value}]),rows:"5",placeholder:"Enter your message here",onInput:_e,ref_key:"messageTextareaRef",ref:A},null,34),[[B,v(s).message]])]),e("div",bt,[e("div",{class:x(["message-counter",{"text-danger":z.value<0,"text-warning":z.value>=0&&z.value<10,"over-limit":z.value<0}])},[z.value>=0?(n(),c("span",wt,u(z.value)+" characters left",1)):(n(),c("span",Ct,u(Math.abs(z.value))+" characters over limit",1))],2)]),d.value.message?(n(),c("div",kt,u(d.value.message),1)):p("",!0)]),e("div",St,[e("div",xt,[E(e("input",{class:"form-check-input",type:"checkbox",id:"scheduled","onUpdate:modelValue":t[8]||(t[8]=l=>v(s).scheduled=l)},null,512),[[Ve,v(s).scheduled]]),t[28]||(t[28]=e("label",{class:"form-check-label fw-bold",for:"scheduled"},"Schedule SMS",-1))]),v(s).scheduled?(n(),c("div",Mt,[e("div",Vt,[e("div",Et,[t[29]||(t[29]=e("label",{for:"schedule_date",class:"form-label"},[m("Select Date"),e("span",{class:"text-danger"},"*")],-1)),E(e("input",{type:"date",id:"schedule_date",class:x(["form-control",{"is-invalid":d.value.schedule_date}]),"onUpdate:modelValue":t[9]||(t[9]=l=>I.value=l),min:se()},null,10,It),[[B,I.value]])]),e("div",Tt,[t[30]||(t[30]=e("label",{for:"schedule_time",class:"form-label"},[m("Select Time"),e("span",{class:"text-danger"},"*")],-1)),E(e("input",{type:"time",id:"schedule_time",class:x(["form-control",{"is-invalid":d.value.schedule_date}]),"onUpdate:modelValue":t[10]||(t[10]=l=>T.value=l)},null,2),[[B,T.value]])])]),e("div",Dt,[I.value&&T.value?(n(),c("span",Ft,[t[31]||(t[31]=e("i",{class:"fas fa-info-circle text-primary"},null,-1)),t[32]||(t[32]=m(" Message will be sent on: ")),e("strong",null,u(Y(I.value,T.value)),1)])):p("",!0)]),t[33]||(t[33]=e("small",{class:"form-text text-muted mt-1"},"Select a future date and time for your SMS to be sent",-1)),d.value.schedule_date?(n(),c("div",Ut,u(d.value.schedule_date),1)):p("",!0)])):p("",!0)]),e("div",$t,[e("button",{type:"button",class:"btn btn-primary ms-2",onClick:he,disabled:L.value},[t[34]||(t[34]=e("i",{class:"fas fa-paper-plane me-1"},null,-1)),m(" "+u(v(s).scheduled?"PREVIEW & SCHEDULE SMS":"PREVIEW & SEND SMS"),1)],8,Pt)])],32)])])])]),e("div",zt,[e("div",Lt,[e("div",Bt,[e("div",{class:"modal-header"},[t[36]||(t[36]=e("h5",{class:"modal-title"},[e("i",{class:"fas fa-file-csv me-2"}),m("Upload CSV File ")],-1)),e("button",{type:"button",class:"btn-close",onClick:R,"aria-label":"Close"})]),e("div",qt,[e("div",At,[e("div",{class:x(["file-drop-zone",{"has-file":g.value,"is-loading":S.value,"is-dragging":N.value}]),onClick:t[11]||(t[11]=l=>!S.value&&re()),onDragover:D(ie,["prevent"]),onDragleave:D(ce,["prevent"]),onDrop:D(de,["prevent"])},[S.value?(n(),c("div",Nt,t[37]||(t[37]=[e("div",{class:"spinner-container"},[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")])],-1),e("div",{class:"upload-text mt-3"}," Validating and processing your CSV file... ",-1),e("div",{class:"upload-subtext"},"This may take a moment",-1)]))):g.value?(n(),c("div",Ot,[t[40]||(t[40]=e("div",{class:"file-icon"},[e("i",{class:"fas fa-file-csv"})],-1)),e("div",jt,[e("div",Ht,u(g.value.name),1),e("div",Wt,u(ne(g.value.size)),1)]),e("button",{type:"button",class:"btn-remove-file",onClick:D(ue,["stop"])},t[39]||(t[39]=[e("i",{class:"fas fa-times"},null,-1)]))])):(n(),c("div",Rt,t[38]||(t[38]=[e("div",{class:"upload-icon"},[e("i",{class:"fas fa-file-upload"})],-1),e("div",{class:"upload-text"}," Drag and drop your CSV file here or click to browse ",-1),e("div",{class:"upload-subtext"},"Supported file: .CSV",-1)])))],34),k.value?(n(),c("div",Gt,[t[41]||(t[41]=e("i",{class:"fas fa-exclamation-circle me-1"},null,-1)),m(" "+u(k.value),1)])):p("",!0),e("input",{type:"file",id:"csv_file",ref_key:"csvFileInput",ref:r,class:"form-control d-none",accept:".csv",onChange:Z},null,544)]),t[42]||(t[42]=e("div",{class:"csv-format-info"},[e("h6",null,[e("i",{class:"fas fa-info-circle me-2"}),m("  CSV Format Requirements ")]),e("ul",null,[e("li",null,"File must be in CSV format"),e("li",null,"File should have a header row"),e("li",null," Must include a column labeled 'phone', 'mobile', 'Telephonee' or 'contact' ")])],-1))]),e("div",Jt,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:R,disabled:S.value}," Cancel ",8,Kt),e("button",{type:"button",class:"btn btn-primary",onClick:fe,disabled:!g.value||S.value||k.value},[e("i",{class:x(["fas",S.value?"fa-spinner fa-spin":"fa-check me-1"])},null,2),m(" "+u(S.value?"Processing...":"Upload File"),1)],8,Qt)])])])]),e("div",Yt,[e("div",Xt,[e("div",Zt,[e("div",{class:"modal-header bg-primary text-white"},[t[43]||(t[43]=e("h5",{class:"modal-title"},"SMS Preview",-1)),e("button",{type:"button",class:"btn-close",onClick:W,"aria-label":"Close"})]),e("div",es,[h.value?(n(),c("div",ts,t[44]||(t[44]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Validating contacts...",-1)]))):o.value?(n(),c("div",ss,[e("div",as,[t[46]||(t[46]=e("div",{class:"card-header bg-primary text-white"},[e("h6",{class:"m-0"},[e("i",{class:"fas fa-comment-alt me-2"}),m("Message Preview ")])],-1)),e("div",ls,[e("div",os,[e("div",null,u(o.value.personalizedMessage||o.value.message||v(s).message),1),t[45]||(t[45]=e("div",null,null,-1))])])]),e("div",ns,[t[51]||(t[51]=e("div",{class:"card-header bg-primary text-white"},[e("h6",{class:"m-0"},[e("i",{class:"fas fa-address-book me-2"}),m("Contact Statistics ")])],-1)),e("div",is,[e("div",cs,[e("div",ds,[t[47]||(t[47]=e("div",{class:"stat-label"},"Total Contacts",-1)),e("div",rs,u(o.value.totalContacts||0),1)]),e("div",us,[t[48]||(t[48]=e("div",{class:"stat-label"},"Valid Contacts",-1)),e("div",vs,u(o.value.validContacts||0),1)]),e("div",ms,[t[49]||(t[49]=e("div",{class:"stat-label"},"Invalid Contacts",-1)),e("div",ps,u(o.value.invalidContacts||0),1)]),e("div",fs,[t[50]||(t[50]=e("div",{class:"stat-label"},"Message Characters",-1)),e("div",_s,u(o.value.messageTotalChars||0),1)])])])]),v(s).scheduled?(n(),c("div",gs,[e("div",hs,[t[53]||(t[53]=e("div",{class:"schedule-icon"},[e("i",{class:"fas fa-calendar-alt"})],-1)),e("div",ys,[t[52]||(t[52]=e("div",{class:"schedule-label"},"Scheduled Delivery",-1)),e("div",bs,u(Y(I.value,T.value)),1)])])])):p("",!0)])):(n(),c("div",ws,t[54]||(t[54]=[e("i",{class:"fas fa-exclamation-triangle me-2"},null,-1),m(" Error loading preview. Please try again. ")])))]),e("div",Cs,[e("button",{type:"button",class:"btn btn-secondary",onClick:W}," Close "),e("button",{type:"button",class:"btn btn-success",onClick:ye,disabled:h.value||o.value&&o.value.validContacts===0},u(v(s).scheduled?"Schedule SMS":"Send SMS"),9,ks)])])])])]),_:1}))}},Is=te(Ss,[["__scopeId","data-v-d5b32309"]]);export{Is as default};
