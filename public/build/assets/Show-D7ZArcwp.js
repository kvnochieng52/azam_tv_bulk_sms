import{_ as K}from"./DashboardLayout-jvpOWrKU.js";import{m as f,L as F,q as $,A as G,k as H,o,h as W,b as t,c as n,e as m,t as l,n as j,d as r,K as O,F as P,r as A,z as S}from"./app-CDjddlxD.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"row mb-2"},Z={class:"col-12"},tt={class:"card"},st={class:"card-header",style:{"background-color":"#007bff"}},et={class:"card-title d-flex align-items-center text-white"},at={class:"card-tools"},lt=["href"],ot={class:"row mb-4"},nt={class:"col-md-3 col-sm-6"},it={class:"small-box bg-light shadow-sm"},dt={class:"inner"},rt={class:"progress",style:{height:"8px"}},ct={class:"mt-2 mb-0"},ut={key:0},mt={class:"col-md-3 col-sm-6"},ft={class:"small-box bg-success"},vt={class:"inner"},gt={class:"col-md-3 col-sm-6"},bt={class:"small-box bg-warning"},ht={class:"inner"},xt={class:"col-md-3 col-sm-6"},_t={class:"small-box bg-danger"},yt={class:"inner"},pt={class:"row"},St={class:"col-md-6"},wt={class:"card shadow-sm border-0"},kt={class:"card-body"},Ct={class:"border p-3 rounded bg-light shadow-sm"},Et={class:"mb-0",style:{"white-space":"pre-wrap"}},Mt={class:"d-flex justify-content-between mt-2 text-muted"},Lt={key:0,class:"badge bg-info p-1"},Dt={key:1,class:"badge bg-success p-1"},It={class:"col-md-6"},Vt={class:"card shadow-sm border-0"},Nt={class:"card-body"},Ut={class:"d-flex justify-content-end"},qt=["href"],Bt={class:"col-md-12 mt-4"},Ft={class:"card shadow-sm border-0"},jt={class:"card-body"},Ot={class:"table-responsive"},Pt={class:"table table-hover"},At={class:"badge bg-info"},Qt={key:0},Rt={class:"d-flex align-items-center"},zt=["href"],Tt={key:0,class:"text-muted"},Jt={key:1},Kt={key:0},$t=["href"],Gt={class:"badge badge-primary ml-2"},Ht={key:1,class:"text-center py-2"},Wt={key:2,class:"text-muted"},Xt={key:0,class:"row mt-4"},Yt={class:"col-12"},Zt={class:"card shadow-sm border-0"},ts={class:"card-body"},ss={class:"table-responsive"},es={class:"table table-sm table-hover table-striped"},as={__name:"Show",props:{text:Object},setup(a){const i=a,d=f(null),v=f(null),g=f([]),b=f(!1),Q=async()=>{if(!(i.text.contact_type!=="list"||!i.text.contact_list)){b.value=!0;try{let e=[];try{e=JSON.parse(i.text.contact_list),Array.isArray(e)||(e=[e.toString()])}catch(x){console.warn("Error parsing contact list JSON:",x),e=i.text.contact_list.split(",").map(_=>_.trim())}if(e.length===0){b.value=!1;return}console.log("Fetching contact lists for IDs:",e);const s=await S.get(route("api.contacts.lists",{ids:e.join(",")}));s.data&&s.data.lists&&(g.value=s.data.lists,console.log("Contact lists loaded:",g.value))}catch(e){console.error("Error fetching contact lists:",e)}finally{b.value=!1}}},h=f({}),c=F({delivered:0,queued:0,failed:0,blacklisted:0});F({delivered:!1,failed:!1,queued:!1});const w=async()=>{try{console.log("Fetching progress data for SMS ID:",i.text.id);const e=await S.get(route("sms.progress"),{params:{text_ids:[i.text.id]}});e.data&&e.data[i.text.id]&&(console.log("Progress data received:",e.data[i.text.id]),d.value=e.data[i.text.id]),await R()}catch(e){console.error("Error fetching progress data:",e)}},R=async()=>{try{console.log("Fetching SMS statistics for SMS ID:",i.text.id);const e=await S.get(route("sms.statistics"),{params:{text_id:i.text.id,include_contacts:!0}});console.log("SMS statistics received:",e.data),c.delivered=e.data.delivered||0,c.queued=e.data.queued||0,c.failed=e.data.failed||0,c.blacklisted=e.data.blacklisted||0,e.data.contacts&&(h.value=e.data.contacts)}catch(e){console.error("Error fetching SMS statistics:",e)}},k=e=>h.value&&h.value[e]?h.value[e].status||"Queued":d.value&&d.value.percentage===100?"Delivered":"Queued",z=e=>{switch(k(e).toLowerCase()){case"delivered":return"bg-success";case"queued":case"pending":return"bg-warning";case"failed":return"bg-danger";case"blacklisted":return"bg-dark";default:return"bg-secondary"}};$(()=>{console.log("SMS details component mounted, setting up progress polling"),w(),i.text.contact_type==="list"&&Q(),v.value=setInterval(()=>{console.log("Polling for progress update (30-second interval)"),w()},3e4)}),G(()=>{console.log("SMS details component unmounting, cleaning up"),v.value&&(clearInterval(v.value),v.value=null)});const p=e=>e?new Date(e).toLocaleString():"",T=e=>e?e.split(",").filter(s=>!!s.trim()):[],J=e=>{if(!e)return"";try{return JSON.parse(e).join(", ")}catch{return e}};return(e,s)=>(o(),H(K,null,{default:W(()=>{var x,_,C,E,M,L,D,I,V,N,U,q,B;return[t("div",Y,[t("div",Z,[t("div",tt,[t("div",st,[t("h3",et,[t("span",null,l(a.text.text_title),1),t("span",{class:j(["badge ms-2 ml-2","bg-"+(((x=d.value)==null?void 0:x.color_code)||((_=a.text.status)==null?void 0:_.color_code))])},l(((C=d.value)==null?void 0:C.status_name)||((E=a.text.status)==null?void 0:E.text_status_name)||"Unknown"),3)]),t("div",at,[t("a",{href:e.route("sms.index"),class:"btn btn-light btn-sm"},s[0]||(s[0]=[t("i",{class:"fas fa-arrow-left mr-1"},null,-1),r(" Back to List ")]),8,lt)])])])])]),t("div",ot,[t("div",nt,[t("div",it,[t("div",dt,[t("h3",null,l(a.text.contacts_count),1),s[2]||(s[2]=t("p",null,"Total Contacts",-1)),t("div",rt,[t("div",{class:"progress-bar",style:O({width:(((M=d.value)==null?void 0:M.percentage)||0)+"%",backgroundColor:((L=d.value)==null?void 0:L.percentage)===100?"#28a745":"#17a2b8"})},null,4)]),t("p",ct,[s[1]||(s[1]=t("span",{class:"text-muted"},"Overall Progress: ",-1)),t("span",{class:"font-weight-bold",style:O({color:((D=d.value)==null?void 0:D.percentage)===100?"#28a745":"#17a2b8"})},[r(l(((I=d.value)==null?void 0:I.percentage)||0)+"% ",1),(V=d.value)!=null&&V.processed&&((N=d.value)!=null&&N.total)?(o(),n("span",ut," ("+l((U=d.value)==null?void 0:U.processed)+"/"+l((q=d.value)==null?void 0:q.total)+") ",1)):m("",!0)],4)])])])]),t("div",mt,[t("div",ft,[t("div",vt,[t("h3",null,l(c.delivered||0),1),s[3]||(s[3]=t("p",null,"SMS DELIVERED",-1))]),s[4]||(s[4]=t("div",{class:"icon"},[t("i",{class:"fas fa-check-circle"})],-1)),s[5]||(s[5]=t("a",{class:"small-box-footer"},[r(" View Delivered SMS "),t("i",{class:"fas fa-arrow-circle-right"})],-1))])]),t("div",gt,[t("div",bt,[t("div",ht,[t("h3",null,l(c.queued||0),1),s[6]||(s[6]=t("p",null,"SMS IN QUEUE",-1))]),s[7]||(s[7]=t("div",{class:"icon"},[t("i",{class:"fas fa-hourglass-half"})],-1)),s[8]||(s[8]=t("a",{class:"small-box-footer"},[r(" View SMS in Queue "),t("i",{class:"fas fa-arrow-circle-right"})],-1))])]),t("div",xt,[t("div",_t,[t("div",yt,[t("h3",null,l(c.failed||0),1),s[9]||(s[9]=t("p",null,"SMS UNDELIVERED",-1))]),s[10]||(s[10]=t("div",{class:"icon"},[t("i",{class:"fas fa-times-circle"})],-1)),s[11]||(s[11]=t("a",{class:"small-box-footer"},[r(" View Undelivered SMS "),t("i",{class:"fas fa-arrow-circle-right"})],-1))])])]),t("div",pt,[t("div",St,[t("div",wt,[s[12]||(s[12]=t("div",{class:"card-header bg-light"},[t("h5",{class:"mb-0"},[t("i",{class:"fas fa-comment mr-2"}),r("Message Content")])],-1)),t("div",kt,[t("div",Ct,[t("p",Et,l(a.text.message),1)]),t("div",Mt,[t("small",null,l(a.text.message.length)+" / 300 characters",1),a.text.scheduled?(o(),n("small",Lt," Scheduled: "+l(p(a.text.schedule_date)),1)):(o(),n("small",Dt,"Immediate send"))])])])]),t("div",It,[t("div",Vt,[s[15]||(s[15]=t("div",{class:"card-header bg-light"},[t("h5",{class:"mb-0"},[t("i",{class:"fas fa-file-export mr-2"}),r("Export Report")])],-1)),t("div",Nt,[s[14]||(s[14]=t("p",{class:"text-muted"},"Export SMS delivery data to Excel format",-1)),t("div",Ut,[t("a",{href:e.route("sms.export.detail",i.text.id),class:"btn btn-primary",target:"_blank"},s[13]||(s[13]=[t("i",{class:"fas fa-file-excel mr-1"},null,-1),r(" Export to Excel ")]),8,qt)])])])]),t("div",Bt,[t("div",Ft,[s[26]||(s[26]=t("div",{class:"card-header bg-light"},[t("h5",{class:"mb-0"},[t("i",{class:"fas fa-info-circle mr-2"}),r("SMS Information")])],-1)),t("div",jt,[t("div",Ot,[t("table",Pt,[t("tbody",null,[t("tr",null,[s[16]||(s[16]=t("th",{style:{width:"200px"}},"Created By",-1)),t("td",null,l(((B=a.text.creator)==null?void 0:B.name)||"System"),1)]),t("tr",null,[s[17]||(s[17]=t("th",null,"Created At",-1)),t("td",null,l(p(a.text.created_at)),1)]),t("tr",null,[s[18]||(s[18]=t("th",null,"Last Updated",-1)),t("td",null,l(p(a.text.updated_at)),1)]),t("tr",null,[s[19]||(s[19]=t("th",null,"Contact Source",-1)),t("td",null,[t("span",At,l(a.text.contact_type==="manual"?"Manual Entry":a.text.contact_type==="csv"?"CSV Import":a.text.contact_type==="list"?"Contact Lists":"Unknown"),1)])]),a.text.contact_type==="csv"?(o(),n("tr",Qt,[s[22]||(s[22]=t("th",null,"CSV File",-1)),t("td",null,[t("div",Rt,[t("span",null,l(a.text.csv_file_name),1),a.text.csv_file_name?(o(),n("a",{key:0,href:e.route("sms.download.csv",a.text.csv_file_name),class:"btn btn-sm btn-success ml-3",target:"_blank",download:""},s[20]||(s[20]=[t("i",{class:"fas fa-download mr-1"},null,-1),r(" Download CSV ")]),8,zt)):m("",!0)]),a.text.csv_file_columns?(o(),n("small",Tt,[s[21]||(s[21]=t("strong",null,"Columns:",-1)),r(" "+l(J(a.text.csv_file_columns)),1)])):m("",!0)])])):m("",!0),a.text.contact_type==="list"?(o(),n("tr",Jt,[s[25]||(s[25]=t("th",null,"Contact Lists",-1)),t("td",null,[g.value.length>0?(o(),n("div",Kt,[(o(!0),n(P,null,A(g.value,(u,y)=>(o(),n("div",{key:y,class:"mb-2"},[t("a",{href:e.route("contacts.show",u.id),class:"btn btn-sm btn-info mr-2"},s[23]||(s[23]=[t("i",{class:"fas fa-eye mr-1"},null,-1),r(" View ")]),8,$t),t("span",null,l(u.name),1),t("span",Gt,l(u.contacts_count||0)+" contacts",1)]))),128))])):b.value?(o(),n("div",Ht,s[24]||(s[24]=[t("div",{class:"spinner-border spinner-border-sm text-primary mr-2",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("span",null,"Loading contact lists...",-1)]))):(o(),n("div",Wt,"No contact lists found"))])])):m("",!0)])])])])])])]),a.text.contact_type==="manual"&&a.text.recepient_contacts?(o(),n("div",Xt,[t("div",Yt,[t("div",Zt,[s[28]||(s[28]=t("div",{class:"card-header bg-light"},[t("h5",{class:"mb-0"},[t("i",{class:"fas fa-users mr-2"}),r("Recipients")])],-1)),t("div",ts,[t("div",ss,[t("table",es,[s[27]||(s[27]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Phone Number"),t("th",null,"Status")])],-1)),t("tbody",null,[(o(!0),n(P,null,A(T(a.text.recepient_contacts),(u,y)=>(o(),n("tr",{key:y},[t("td",null,l(y+1),1),t("td",null,l(u),1),t("td",null,[t("span",{class:j(["badge",z(u)])},l(k(u)),3)])]))),128))])])])])])])])):m("",!0)]}),_:1}))}},is=X(as,[["__scopeId","data-v-a9a5f739"]]);export{is as default};
