import{j as b,c as o,o as a,b as t,e as c,K as A,t as d,m as f,q as ut,A as ft,k as mt,h as W,d as i,f as vt,v as ht,F as T,r as D,a as E,u as bt,S as gt,n as B,w as pt,z as X,p as Y}from"./app-CDjddlxD.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as yt}from"./DashboardLayout-jvpOWrKU.js";import{_ as _t}from"./Pagination-Cn-U2vRS.js";const kt=["width","height"],wt=["stroke"],Ct=["stroke","stroke-dasharray"],St={__name:"ProgressDonut",props:{percentage:{type:Number,default:0,validator:n=>n>=0&&n<=100},processed:{type:Number,default:0},total:{type:Number,default:0},size:{type:Number,default:40},color:{type:String,default:"#28a745"},backgroundColor:{type:String,default:"#e9ecef"},textColor:{type:String,default:"#343a40"},showPercentage:{type:Boolean,default:!0},showCount:{type:Boolean,default:!1}},setup(n){const _=n,k=b(()=>({width:`${_.size}px`,height:`${_.size}px`})),g=b(()=>_.size/3.5);return(V,L)=>(a(),o("div",{class:"progress-donut",style:A(k.value)},[(a(),o("svg",{width:n.size,height:n.size,viewBox:"0 0 42 42"},[t("circle",{class:"donut-ring",cx:"21",cy:"21",r:"15.91549430918954",fill:"transparent",stroke:n.backgroundColor,"stroke-width":"3"},null,8,wt),t("circle",{class:"donut-segment",cx:"21",cy:"21",r:"15.91549430918954",fill:"transparent",stroke:n.color,"stroke-width":"3","stroke-dasharray":`${n.percentage} ${100-n.percentage}`,"stroke-dashoffset":"25"},null,8,Ct),n.showPercentage&&n.showCount?(a(),o("text",{key:0,class:"donut-number",x:"50%",y:"45%","text-anchor":"middle","alignment-baseline":"middle",style:A({fontSize:g.value+"px",fill:n.percentage===100?"#28a745":n.textColor})},d(n.processed)+"/"+d(n.total),5)):n.showPercentage?(a(),o("text",{key:1,class:"donut-number",x:"50%",y:"50%","text-anchor":"middle","alignment-baseline":"middle",style:A({fontSize:g.value+"px",fill:n.percentage===100?"#28a745":n.textColor})},d(n.percentage)+"% ",5)):c("",!0)],8,kt))],4))}},xt=Z(St,[["__scopeId","data-v-8202c796"]]),Tt={class:"row"},Dt={class:"col-12"},Mt={class:"card"},It={class:"card-header"},Nt={class:"card-tools"},$t=["href"],Pt={class:"card-body"},zt={class:"dataTables_wrapper dt-bootstrap4"},Bt={class:"row mb-3"},Vt={class:"col-sm-12 col-md-6"},At={class:"dataTables_length"},Et={class:"d-flex align-items-center"},Lt={class:"col-sm-12 col-md-6 text-right"},jt={class:"btn-group"},Ft=["href"],Ot={class:"table-responsive"},Ut={class:"table table-bordered table-striped table-hover"},qt={key:0},Jt={class:"d-flex align-items-center"},Kt={class:"me-2 mr-2"},Gt={class:"d-flex align-items-center"},Ht=["onClick"],Qt={class:"btn-group"},Rt=["href"],Wt=["href"],Xt=["onClick"],Yt={key:0,class:"row mt-3"},Zt={class:"col-sm-12 col-md-5"},te={class:"dataTables_info"},ee={class:"col-sm-12 col-md-7"},se={class:"dataTables_paginate paging_simple_numbers d-flex justify-content-end"},le={key:1,class:"row mt-3"},ae={class:"col-12"},oe={class:"dataTables_info"},ne={key:0,class:"modal-backdrop fade show"},re={key:1,class:"modal show",tabindex:"-1",style:{display:"block"},"aria-hidden":"true"},ie={class:"modal-dialog modal-lg"},de={class:"modal-content"},ce={class:"modal-header"},ue={class:"modal-title"},fe={class:"modal-body"},me={key:0,class:"text-center p-5"},ve={key:1},he={key:0},be={class:"card card-body bg-light mb-3"},ge={class:"row"},pe={class:"list-unstyled contact-list"},ye={key:1},_e=["href"],ke={key:1,class:"alert alert-warning"},we={key:2},Ce={key:0,class:"text-center py-4"},Se={key:1,class:"card card-body bg-light mb-3"},xe={class:"table-responsive"},Te={class:"table table-striped"},De={class:"badge badge-info"},Me=["href"],Ie={key:2,class:"alert alert-warning"},Ne={key:3,class:"alert alert-info"},$e={class:"modal-footer"},Pe={class:"modal fade",id:"deleteModal",tabindex:"-1","aria-hidden":"true"},ze={class:"modal-dialog"},Be={class:"modal-content"},Ve={class:"modal-body"},Ae={class:"modal-footer"},Ee=["disabled"],Le={class:"modal-dialog modal-dialog-centered",role:"document"},je={class:"modal-content"},Fe={class:"modal-header bg-info text-white"},Oe={class:"modal-body"},Ue={key:0,class:"card"},qe={class:"card-body"},Je={class:"card-title"},Ke={class:"card-text"},Ge={key:0},He={class:"list-group"},Qe={class:"d-flex w-100 justify-content-between"},Re={class:"mb-1"},We={class:"modal-footer"},Xe=["href"],Ye={__name:"Index",props:{texts:Object,filters:Object},setup(n){var F;const _=n,k=f(((F=_.filters)==null?void 0:F.search)||""),g=b(()=>_.texts.data);let V=null;const L=()=>{clearTimeout(V),V=setTimeout(()=>{Y.get(route("sms.index"),{search:k.value},{preserveState:!0,replace:!0})},500)},r=f(null),w=f(!1),v=f(!1),M=f([]),h=f(null),C=f(!1),tt=b(()=>{if(!r.value)return"";switch(r.value.contact_type){case"manual":return"Manual Entry";case"csv":return"CSV Upload";case"list":return"Contact List";default:return"Unknown"}});b(()=>{if(!r.value||r.value.contact_type!=="list"||!r.value.contact_list)return[];try{return JSON.parse(r.value.contact_list)}catch(s){return console.log("Error parsing contact list JSON, trying comma-separated format:",s),r.value.contact_list.split(",").map(e=>e.trim()).filter(Boolean)}});const et=b(()=>{if(!r.value||r.value.contact_type!=="manual"||!r.value.recepient_contacts)return[[],[],[]];const s=r.value.recepient_contacts.split(",").map(m=>m.trim()).filter(Boolean),e=[[],[],[]],u=Math.ceil(s.length/3);return s.forEach((m,$)=>{const x=Math.floor($/u);x<3?e[x].push(m):e[2].push(m)}),e}),st=b(()=>{if(!r.value)return"fas fa-question-circle mr-2";switch(r.value.contact_type){case"manual":return"fas fa-keyboard mr-2";case"csv":return"fas fa-file-csv mr-2";case"list":return"fas fa-list-alt mr-2";default:return"fas fa-question-circle mr-2"}}),lt=b(()=>{if(!r.value)return"alert-secondary";switch(r.value.contact_type){case"manual":return"alert-info";case"csv":return"alert-info";case"list":return"alert-info";default:return"alert-info"}}),at=async s=>{r.value=s,v.value=!0,M.value=[],w.value=!0;try{if(s.contact_type==="manual")v.value=!1;else if(s.contact_type==="list"){let e=[];if(s.contact_list)try{e=JSON.parse(s.contact_list)}catch{e=s.contact_list.split(",").map(m=>m.trim()).filter(Boolean)}if(console.log("Extracted contact IDs:",e),e.length>0)try{const u=await X.post(route("contacts.get-contacts"),{contact_ids:e});console.log("API response:",u.data),u.data&&u.data.contacts?M.value=u.data.contacts:console.error("No contacts returned from API")}catch(u){console.error("Error fetching contacts:",u)}v.value=!1}else s.contact_type==="csv"&&(v.value=!1)}catch(e){console.error("Error in viewContacts:",e),v.value=!1}},p=f({}),I=f(null),ot=()=>g.value.filter(s=>s.status_id>=1&&s.status_id<=4||s.status_id===7).map(s=>s.id),j=async()=>{const s=ot();if(console.log("Active text IDs for progress updates:",s),s.length===0){console.log("No active texts to fetch progress for");return}try{console.log("Fetching progress data from API...");const e=await X.get(route("sms.progress"),{params:{text_ids:s}});console.log("Progress data received:",e.data),p.value=e.data}catch(e){console.error("Error fetching progress data:",e)}},nt=(s,e)=>e===100?"#28a745":s===6||s===5?"#dc3545":s===4?"#ffc107":s===3?"#28a745":s===2?"#17a2b8":"#6c757d";ut(()=>{console.log("Component mounted, setting up progress polling"),j(),I.value=setInterval(()=>{console.log("Progress poll triggered (30-second interval)"),j()},3e3)}),ft(()=>{console.log("Component unmounting, cleaning up interval"),I.value&&(clearInterval(I.value),I.value=null)});const S=f(null),N=f(!1),rt=s=>{S.value=s,new bootstrap.Modal(document.getElementById("deleteModal")).show()},it=()=>{S.value&&(N.value=!0,Y.delete(route("sms.destroy",S.value.id),{onSuccess:()=>{bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide(),N.value=!1,S.value=null},onError:()=>{N.value=!1}}))},dt=s=>s?new Date(s).toLocaleString():"";return(s,e)=>(a(),mt(yt,null,{default:W(()=>{var u,m,$,x,O,U,q;return[t("div",Tt,[t("div",Dt,[t("div",Mt,[t("div",It,[e[7]||(e[7]=t("h3",{class:"card-title"},[t("i",{class:"far fa-list-alt nav-icon"}),i("   SMS Messages ")],-1)),t("div",Nt,[t("a",{href:s.route("sms.create"),class:"btn btn-primary btn-sm"},e[6]||(e[6]=[t("i",{class:"fas fa-plus mr-1"},null,-1),i(" New SMS ")]),8,$t)])]),t("div",Pt,[t("div",zt,[t("div",Bt,[t("div",Vt,[t("div",At,[t("label",Et,[e[8]||(e[8]=i(" Search: ")),vt(t("input",{type:"search",class:"form-control form-control-sm ms-2 ml-2",placeholder:"Search SMS messages...","onUpdate:modelValue":e[0]||(e[0]=l=>k.value=l),onInput:L},null,544),[[ht,k.value]])])])]),t("div",Lt,[t("div",jt,[t("a",{href:s.route("sms.export.csv",{search:k.value}),class:"btn btn-success btn-sm"},e[9]||(e[9]=[t("i",{class:"fas fa-file-csv mr-1"},null,-1),i(" Export to CSV ")]),8,Ft)])])]),t("div",Ot,[t("table",Ut,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",null,"Title"),t("th",null,"Status"),t("th",null,"Contacts"),t("th",null,"Created By"),t("th",null,"Created At"),t("th",null,"Actions")])],-1)),g.value.length>0?(a(),o("tbody",qt,[(a(!0),o(T,null,D(g.value,l=>{var y,P,z,J,K,G,H,Q,R;return a(),o("tr",{key:l.id},[t("td",null,[t("b",null,[E(bt(gt),{href:s.route("sms.show",l.id)},{default:W(()=>[i(d(l.text_title),1)]),_:2},1032,["href"])])]),t("td",Jt,[t("div",Kt,[E(xt,{percentage:((y=p.value[l.id])==null?void 0:y.percentage)||0,processed:((P=p.value[l.id])==null?void 0:P.processed)||0,total:((z=p.value[l.id])==null?void 0:z.total)||l.contacts_count||0,size:36,color:nt(l.status_id,((J=p.value[l.id])==null?void 0:J.percentage)||0),"show-percentage":!0,"show-count":!1},null,8,["percentage","processed","total","color"])]),t("span",{class:B(["badge","bg-"+(((K=p.value[l.id])==null?void 0:K.color_code)||((G=l.status)==null?void 0:G.color_code))])},d(((H=p.value[l.id])==null?void 0:H.status_name)||((Q=l.status)==null?void 0:Q.text_status_name)),3)]),t("td",null,[t("div",Gt,[t("button",{class:"btn btn-sm btn-outline-info ml-2",onClick:pt(ct=>at(l),["prevent"]),title:"View Contacts"},e[10]||(e[10]=[t("i",{class:"fas fa-eye"},null,-1),i(" view ")]),8,Ht)])]),t("td",null,d((R=l.creator)==null?void 0:R.name),1),t("td",null,d(dt(l.created_at)),1),t("td",null,[t("div",Qt,[t("a",{href:s.route("sms.show",l.id),class:"btn btn-outline-info btn-sm"},e[11]||(e[11]=[t("i",{class:"fas fa-eye"},null,-1)]),8,Rt),l.status_id<=1?(a(),o("a",{key:0,href:s.route("sms.edit",l.id),class:"btn btn-outline-primary btn-sm me-1"},e[12]||(e[12]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Wt)):c("",!0),l.status_id<=2?(a(),o("button",{key:1,onClick:ct=>rt(l),class:"btn btn-outline-danger btn-sm"},e[13]||(e[13]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Xt)):c("",!0)])])])}),128))])):c("",!0)])]),n.texts.data.length>0?(a(),o("div",Yt,[t("div",Zt,[t("div",te," Showing "+d(n.texts.from)+" to "+d(n.texts.to)+" of "+d(n.texts.total)+" entries ",1)]),t("div",ee,[t("div",se,[E(_t,{links:n.texts.links},null,8,["links"])])])])):c("",!0),s.isSearching&&s.searchTerm?(a(),o("div",le,[t("div",ae,[t("div",oe," Found "+d(g.value.length)+' matching results for "'+d(s.searchTerm)+'" ',1)])])):c("",!0)])])])])]),w.value?(a(),o("div",ne)):c("",!0),w.value?(a(),o("div",re,[t("div",ie,[t("div",de,[t("div",ce,[t("h5",ue,[e[15]||(e[15]=t("i",{class:"fas fa-address-book mr-2"},null,-1)),i(" Contacts for: "+d((u=r.value)==null?void 0:u.text_title),1)]),t("button",{type:"button",class:"close",onClick:e[1]||(e[1]=l=>w.value=!1),"aria-label":"Close"},e[16]||(e[16]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("div",fe,[v.value?(a(),o("div",me,e[17]||(e[17]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("p",{class:"mt-2"},"Loading contacts...",-1)]))):(a(),o("div",ve,[t("div",{class:B(["alert",lt.value])},[t("i",{class:B(st.value)},null,2),e[18]||(e[18]=t("strong",null,"Contact Type:",-1)),i(" "+d(tt.value),1)],2),((m=r.value)==null?void 0:m.contact_type)==="manual"&&(($=r.value)!=null&&$.recepient_contacts)?(a(),o("div",he,[t("div",be,[t("div",ge,[(a(!0),o(T,null,D(et.value,(l,y)=>(a(),o("div",{key:y,class:"col-md-4"},[t("ul",pe,[(a(!0),o(T,null,D(l,(P,z)=>(a(),o("li",{key:z,class:"mb-2"},[e[19]||(e[19]=t("i",{class:"fas fa-mobile-alt text-primary mr-2"},null,-1)),i(" "+d(P),1)]))),128))])]))),128))])])])):((x=r.value)==null?void 0:x.contact_type)==="csv"?(a(),o("div",ye,[e[22]||(e[22]=t("p",{class:"mb-3"},[t("i",{class:"fas fa-file-csv mr-2"}),i(" Contacts were uploaded via CSV file. ")],-1)),(O=r.value)!=null&&O.csv_file_path?(a(),o("a",{key:0,href:s.route("sms.download.csv",[r.value.csv_file_name]),class:"btn btn-primary",download:""},e[20]||(e[20]=[t("i",{class:"fas fa-download mr-2"},null,-1),i(" Download Original CSV File ")]),8,_e)):(a(),o("div",ke,e[21]||(e[21]=[t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1),i(" The original CSV file is not available. ")])))])):((U=r.value)==null?void 0:U.contact_type)==="list"?(a(),o("div",we,[v.value?(a(),o("div",Ce,e[23]||(e[23]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("p",{class:"mt-2"},"Loading contacts from selected lists...",-1)]))):M.value.length>0?(a(),o("div",Se,[t("div",xe,[t("table",Te,[e[26]||(e[26]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Contact Name"),t("th",null,"Contacts Count"),t("th",null,"Actions")])],-1)),t("tbody",null,[(a(!0),o(T,null,D(M.value,(l,y)=>(a(),o("tr",{key:l.id||y},[t("td",null,d(y+1),1),t("td",null,[e[24]||(e[24]=t("i",{class:"fas fa-users text-primary mr-2"},null,-1)),i(" "+d(l.full_name),1)]),t("td",null,[t("span",De,d(l.contacts_count||0),1)]),t("td",null,[t("a",{href:s.route("contacts.show",l.id),class:"btn btn-sm btn-info",target:"_blank"},e[25]||(e[25]=[t("i",{class:"fas fa-eye"},null,-1),i(" View ")]),8,Me)])]))),128))])])])])):v.value?c("",!0):(a(),o("div",Ie,e[27]||(e[27]=[t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1),i(" No contacts found for the selected list(s). ")])))])):(a(),o("div",Ne,e[28]||(e[28]=[t("i",{class:"fas fa-info-circle mr-2"},null,-1),i(" No contact information is available. ")])))]))]),t("div",$e,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[2]||(e[2]=l=>w.value=!1)}," Close ")])])])])):c("",!0),t("div",Pe,[t("div",ze,[t("div",Be,[e[34]||(e[34]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Confirm Delete"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Ve,[t("p",null,[e[29]||(e[29]=i(" Are you sure you want to delete the SMS ")),t("strong",null,'"'+d((q=S.value)==null?void 0:q.text_title)+'"',1),e[30]||(e[30]=i("? "))]),e[31]||(e[31]=t("p",{class:"text-danger"},"This action cannot be undone.",-1))]),t("div",Ae,[e[33]||(e[33]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Cancel ",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:it,disabled:N.value},e[32]||(e[32]=[t("i",{class:"fas fa-trash mr-1"},null,-1),i(" Delete ")]),8,Ee)])])])]),t("div",{class:B(["modal",{"d-block":C.value}]),tabindex:"-1",role:"dialog"},[t("div",Le,[t("div",je,[t("div",Fe,[e[36]||(e[36]=t("h5",{class:"modal-title"},[t("i",{class:"fas fa-address-card mr-2"}),i(" Contact Details ")],-1)),t("button",{type:"button",class:"close",onClick:e[3]||(e[3]=l=>C.value=!1),"aria-label":"Close"},e[35]||(e[35]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("div",Oe,[h.value?(a(),o("div",Ue,[t("div",qe,[t("h5",Je,d(h.value.full_name),1),t("p",Ke,[e[37]||(e[37]=t("i",{class:"fas fa-phone text-primary mr-2"},null,-1)),e[38]||(e[38]=t("strong",null,"Primary Phone:",-1)),i(" "+d(h.value.phone_number),1)]),h.value.lists&&h.value.lists.length>0?(a(),o("div",Ge,[e[39]||(e[39]=t("hr",null,null,-1)),e[40]||(e[40]=t("h6",null,[t("i",{class:"fas fa-list-ul mr-2"}),i(" Associated Contact Lists: ")],-1)),t("div",He,[(a(!0),o(T,null,D(h.value.lists,l=>(a(),o("div",{key:l.id,class:"list-group-item list-group-item-action flex-column align-items-start"},[t("div",Qe,[t("h6",Re,d(l.name),1)])]))),128))])])):c("",!0)])])):c("",!0)]),t("div",We,[h.value?(a(),o("a",{key:0,href:s.route("contacts.show",h.value.id),class:"btn btn-primary"},e[41]||(e[41]=[t("i",{class:"fas fa-external-link-alt mr-1"},null,-1),i(" View Full Details ")]),8,Xe)):c("",!0),t("button",{type:"button",class:"btn btn-secondary",onClick:e[4]||(e[4]=l=>C.value=!1)}," Close ")])])]),C.value?(a(),o("div",{key:0,class:"modal-backdrop fade show",onClick:e[5]||(e[5]=l=>C.value=!1)})):c("",!0)],2)]}),_:1}))}},ls=Z(Ye,[["__scopeId","data-v-33eb467c"]]);export{ls as default};
